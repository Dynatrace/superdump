@model SuperDumpService.ViewModels.ReportViewModel

@{
	ViewData["Title"] = "Report";
}
@if (Model == null) {
	<h2>Requested dump does not exist.</h2>
	<p>... but might get created in a few seconds...</p>

	<script>
		setTimeout(function () {
			window.location.reload(1);
		}, 5000);
	</script>

} else {
	<h2>Dump Id: @Model.DumpId</h2>

	<div style="display: block; float: right;">
		@using (Html.BeginForm("Rerun", "Home")) {
			<input type="hidden" name="bundleId" value="@Model.BundleId" />
			<input type="hidden" name="dumpId" value="@Model.DumpId" />
			<input type="submit" value="Rerun Analysis" />
		}
	</div>

	<dl class="dl-horizontal smaller">
		@if (!string.IsNullOrEmpty(Model.BundleFileName) && Model.BundleFileName != Model.DumpFileName) {
			<dt>BundleFileName:</dt>
			<dd>@Model.BundleFileName</dd>
		}
		@if (!string.IsNullOrEmpty(Model.DumpFileName)) {
			<dt>DumpFileName:</dt>
			<dd>@Model.DumpFileName</dd>
		}

		<dt>Time:</dt>
		<dd>@Model.TimeStamp</dd>

		@foreach (var customProp in Model.CustomProperties) {
			<dt>
				@customProp.Key:
			</dt>
			<dd>
				@if (@customProp.Value.StartsWith("http")) {
					<a href="@customProp.Value"> @customProp.Value </a>
				} else {
					@customProp.Value
				}
			</dd>
		}

		<dt>Files:</dt>
		<dd>
			<ul class="flat">
				@foreach (var file in Model.Files) {
					<li><a asp-controller="Home" asp-action="DownloadFile" asp-route-bundleId="@Model.BundleId" asp-route-dumpId="@Model.DumpId" asp-route-filename="@file">@file</a></li>
				}
			</ul>
		</dd>
	</dl>

	<div class="container-fluid">
		@if (Model.HasAnalysisFailed) {
			<h2>Analysis failed with errors, no report avaliable.</h2>
			<pre>Error: @Model.AnalysisError</pre>
		} else if (Model.Result == null) {
			<h2>hang tight, still processing</h2>
			<script>
				setTimeout(function () {
					window.location.reload(1);
				}, 5000);
			</script>
		} else {
			<section>
				@{Html.RenderPartial("_Summary");}
			</section>
			<section>
				@{Html.RenderPartial("_System");}
			</section>
			<section>
				@{Html.RenderPartial("_Threads");}
			</section>
			<section>
				@{Html.RenderPartial("_Modules");}
			</section>
			<section>
				@{ Html.RenderPartial("_Domains");}
			</section>
			<section>
				@{Html.RenderPartial("_Memory");}
			</section>
		}
	</div>
}
